---
layout: post
title:  "mental学习小记"
categories: 图像学
tags:  mental
author: 何勇
---

* content
{:toc}

# MTKDrawer
设计一个底层基类，初始化mental基础配置功能
```swift
import MetalKit
class MTKDrawer {
    let renderPipelineState: MTLRenderPipelineState

    init(
        device: MTLDevice,
        library: MTLLibrary,
        pixelFormat: MTLPixelFormat,
        vertexFunctionName: String,
        fragmentFunctionName: String
    ) throws {
        let vertexFunction = library.makeFunction(name: vertexFunctionName)
        let fragmentFunction = library.makeFunction(name: fragmentFunctionName)

        let renderPipelineDescriptor = MTLRenderPipelineDescriptor()
        renderPipelineDescriptor.vertexFunction = vertexFunction
        renderPipelineDescriptor.fragmentFunction = fragmentFunction
        renderPipelineDescriptor.colorAttachments[0].pixelFormat = pixelFormat
        renderPipelineDescriptor.colorAttachments[0].isBlendingEnabled = true
        renderPipelineDescriptor.colorAttachments[0].sourceRGBBlendFactor = .sourceAlpha
        renderPipelineDescriptor.colorAttachments[0].sourceAlphaBlendFactor = .one
        renderPipelineDescriptor.colorAttachments[0].destinationRGBBlendFactor = .oneMinusSourceAlpha
        renderPipelineDescriptor.colorAttachments[0].destinationAlphaBlendFactor = .one
        renderPipelineDescriptor.colorAttachments[0].rgbBlendOperation = .add
        renderPipelineDescriptor.colorAttachments[0].alphaBlendOperation = .max

        guard
            let renderPipelineState = try? device.makeRenderPipelineState(descriptor: renderPipelineDescriptor)
        else { throw MTKError(message: "No MTLRenderPipelineState") }
        self.renderPipelineState = renderPipelineState
    }
}
```

# structure
![markdown picture](../picture/mental.png)
    

